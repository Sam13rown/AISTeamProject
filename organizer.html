<html>
    <head>
        <link rel="stylesheet" href="organizer.css">
        <link rel="stylesheet" href="calendar.css">
    </head>
    <body>
        <!-- Page Title -->
        <div id="title"><p>Study Connect</p></div>
        <!-- Links/Apps -->
        <div id="link-container">
            <div id="add-link-container">
                <div id="link-input-container">
                    <input type="text" placeholder="Enter Link" id="input-link" class="input">
                    <input type="text" placeholder="Enter Image URL" id="input-img" class="input">
                </div>
                
                <button id="add-link">+</button>
                <button id="toggle-delete">Link</button>
            </div>

            <div id="app-container"></div>
        </div>
        <!-- Todo List -->
        <div id="todo-container">
            <div id="add-task-container">
                <input type="text" placeholder="Enter Task" id="input-task" class="input">
                <button id="add-task">+</button>
            </div>

            <div id="task-container"></div>
        </div>
        <!-- calendar -->
        <img id="show-calendar-btn" src="https://creazilla-store.fra1.digitaloceanspaces.com/cliparts/76494/calendar-clipart-xl.png" width="100px">
        <div id="container">
            <div id="header">
              <div id="monthDisplay"></div>
              <div>
                <button id="backButton">Back</button>
                <button id="nextButton">Next</button>
                <button id="close-calendar-btn">X</button>
              </div>
            </div>
      
            <div id="weekdays">
              <div>Sunday</div>
              <div>Monday</div>
              <div>Tuesday</div>
              <div>Wednesday</div>
              <div>Thursday</div>
              <div>Friday</div>
              <div>Saturday</div>
            </div>
      
            <div id="calendar"></div>
        </div>
      
          <div id="newEventModal">
            <h2>New Event</h2>
      
            <input id="eventTitleInput" placeholder="Event Title" />
      
            <button id="saveButton">Save</button>
            <button id="cancelButton">Cancel</button>
          </div>
      
          <div id="deleteEventModal">
            <h2>Event</h2>
      
            <p id="eventText"></p>
      
            <button id="deleteButton">Delete</button>
            <button id="closeButton">Close</button>
          </div>
      
          <div id="modalBackDrop"></div>
    </body>
    <!-- App Script -->
    <script>
        const inputLink = document.getElementById("input-link");
        const addLink = document.getElementById("add-link");
        const appContainer = document.getElementById("app-container");
        const inputImg = document.getElementById("input-img");
        const toggleDelete = document.getElementById("toggle-delete");

        let apps = localStorage.getItem('apps') ? JSON.parse(localStorage.getItem('apps')) : [];

        // localStorage.clear()
        console.log(localStorage);
        console.log(apps);

        let deleting = false;
        toggleDelete.addEventListener('click', () =>{
            if(deleting){
                deleting = false;
                toggleDelete.innerText = "Link";
                console.log(deleting);
            }
            else{
                deleting = true;
                toggleDelete.innerText = "Delete";
                console.log(deleting);
            }
        });

        for(savedApp of apps){
            let app = document.createElement("button");
            
            app.classList.add("app");
            let link = savedApp.href;
            app.addEventListener('click', function(){
                if(deleting){
                    apps = apps.filter(e => e.href != link);
                    localStorage.setItem('apps', JSON.stringify(apps));
                    console.log(localStorage);
                    console.log(apps);
                    app.remove()
                }
                else{
                    window.location = link;
                }
            });

            let image = document.createElement("img");
            image.classList.add("app-img");
            image.src = savedApp.img;
            app.appendChild(image);

            appContainer.appendChild(app);
        }

        addLink.addEventListener('click', function(){
            // Check if valid URLS
            if(!(isValidUrl(inputLink.value))){
                alert("The website link you entered is not valid!");
                inputLink.value = "";
                return
            }
            if(!(isValidUrl(inputImg.value))){
                alert("The image url you entered is not valid!");
                inputImg.value = "";
                return
            }

            let app = document.createElement("button");
            app.classList.add("app");
            app.href = inputLink.value;
            inputLink.value = "";
            app.addEventListener('click', function(){
                if(deleting){
                    apps = apps.filter(e => e.href != app.href);
                    localStorage.setItem('apps', JSON.stringify(apps));
                    console.log(localStorage);
                    console.log(apps);
                    app.remove();
                }
                else{
                    window.location = app.href;
                }
            });

            let image = document.createElement("img");
            image.classList.add("app-img");
            image.src = inputImg.value;
            inputImg.value = "";
            app.appendChild(image);

            // Add code here to save as json href:link, image:url
            apps.push({
                href: app.href,
                img: image.src
            });

            localStorage.setItem('apps', JSON.stringify(apps));


            appContainer.appendChild(app);

            function isValidUrl(string) {
                let url;
                try {
                    url = new URL(string);
                } catch (_) {
                    return false;
                }
                return true;
            }



        });       
    </script>
    <!-- Todo List Script -->
    <script>
        const inputTask = document.getElementById("input-task");
        const addTask = document.getElementById("add-task");
        const taskContainer = document.getElementById("task-container");

        let tasks = localStorage.getItem('tasks') ? JSON.parse(localStorage.getItem('tasks')) : [];

        for(savedTask of tasks){
            console.log(savedTask);
            let task = savedTask.task;
            let striked = savedTask.striked;
            let taskBox = document.createElement("div");
            taskBox.classList.add('task');

            let li = document.createElement('li');
            li.innerText = task;
            if(striked){
                li.innerHTML = li.innerText.strike();
            }
            taskBox.appendChild(li);

            let checkButton = document.createElement("button");
            checkButton.innerHTML = '&#10003';
            checkButton.classList.add('check-button');
            taskBox.appendChild(checkButton);

            let deleteButton = document.createElement("button");
            deleteButton.innerHTML = '&#10005';
            deleteButton.classList.add('delete-button');
            taskBox.appendChild(deleteButton);

            taskContainer.appendChild(taskBox);

            checkButton.addEventListener('click', function(){
                li.innerHTML = li.innerText.strike();
                for(savedTask of tasks){
                    if(savedTask.task === task){
                        savedTask.striked = true;
                        localStorage.setItem('tasks', JSON.stringify(tasks));
                    }
                }
            });

            deleteButton.addEventListener('click', function(){
                tasks = tasks.filter(e => e.task != task);
                localStorage.setItem('tasks', JSON.stringify(tasks));
                taskContainer.removeChild(taskBox);
            });
        }


        addTask.addEventListener('click', function(){
            let task = document.createElement("div");
            task.classList.add('task');

            tasks.push({
                task:inputTask.value,
                striked:false
            });

            localStorage.setItem('tasks', JSON.stringify(tasks));

            let li = document.createElement('li');
            li.innerText = `${inputTask.value}`;
            task.appendChild(li);

            let checkButton = document.createElement("button");
            checkButton.innerHTML = '&#10003';
            checkButton.classList.add('check-button');
            task.appendChild(checkButton);

            let deleteButton = document.createElement("button");
            deleteButton.innerHTML = '&#10005';
            deleteButton.classList.add('delete-button');
            task.appendChild(deleteButton);

            if(inputTask.value == ""){
                alert('Please enter a task');
            }
            else{
                console.log("append");
                taskContainer.appendChild(task);
            }

            inputTask.value = "";

            checkButton.addEventListener('click', function(){
                li.innerHTML = li.innerText.strike();
                for(savedTask of tasks){
                    if(savedTask.task === task){
                        savedTask.striked = true;
                        localStorage.setItem('tasks', JSON.stringify(tasks));
                    }
                }
            });

            deleteButton.addEventListener('click', function(){
                taskContainer.removeChild(task);
            });
        });
    </script>
    <!-- calendar script -->
    <script>
        let nav = 0;
        let clicked = null;
        let events = localStorage.getItem('events') ? JSON.parse(localStorage.getItem('events')) : [];

        const calendar = document.getElementById('calendar');
        const container = document.getElementById('container');
        const newEventModal = document.getElementById('newEventModal');
        const deleteEventModal = document.getElementById('deleteEventModal');
        const backDrop = document.getElementById('modalBackDrop');
        const eventTitleInput = document.getElementById('eventTitleInput');
        const weekdays = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];

        const showBtn = document.getElementById('show-calendar-btn').addEventListener('click', () => {
            container.style.display = 'block';
            backDrop.style.display = 'block';
        });

        const closeBtn = document.getElementById('close-calendar-btn').addEventListener('click', () =>{
            container.style.display = 'none';
            backDrop.style.display = 'none';
        });

        function openDay(date) {
        clicked = date;

        const eventForDay = events.find(e => e.date === clicked);

        if (eventForDay) {
            document.getElementById('eventText').innerText = eventForDay.title;
            deleteEventModal.style.display = 'block';
        } else {
            newEventModal.style.display = 'block';
        }

        // backDrop.style.display = 'block';
        }

        function load() {
        const dt = new Date();

        if (nav !== 0) {
            dt.setMonth(new Date().getMonth() + nav);
        }

        const day = dt.getDate();
        const month = dt.getMonth();
        const year = dt.getFullYear();

        const firstDayOfMonth = new Date(year, month, 1);
        const daysInMonth = new Date(year, month + 1, 0).getDate();
        
        const dateString = firstDayOfMonth.toLocaleDateString('en-us', {
            weekday: 'long',
            year: 'numeric',
            month: 'numeric',
            day: 'numeric',
        });
        const paddingDays = weekdays.indexOf(dateString.split(', ')[0]);

        document.getElementById('monthDisplay').innerText = 
            `${dt.toLocaleDateString('en-us', { month: 'long' })} ${year}`;

        calendar.innerHTML = '';

        for(let i = 1; i <= paddingDays + daysInMonth; i++) {
            const daySquare = document.createElement('div');
            daySquare.classList.add('day');

            const dayString = `${month + 1}/${i - paddingDays}/${year}`;

            if (i > paddingDays) {
                daySquare.innerText = i - paddingDays;
                const eventForDay = events.find(e => e.date === dayString);

                if (i - paddingDays === day && nav === 0) {
                    daySquare.id = 'currentDay';
                }

                if (eventForDay) {
                    const eventDiv = document.createElement('div');
                    eventDiv.classList.add('event');
                    eventDiv.innerText = eventForDay.title;
                    daySquare.appendChild(eventDiv);
                }

                daySquare.addEventListener('click', () => openDay(dayString));
            } else {
                daySquare.classList.add('padding');
            }

            calendar.appendChild(daySquare);    
        }
        }

        function closeModal() {
            eventTitleInput.classList.remove('error');
            newEventModal.style.display = 'none';
            deleteEventModal.style.display = 'none';
            // backDrop.style.display = 'none';
            eventTitleInput.value = '';
            clicked = null;
            load();
        }

        function saveEvent() {
            if (eventTitleInput.value) {
                eventTitleInput.classList.remove('error');

                events.push({
                date: clicked,
                title: eventTitleInput.value,
                });

                localStorage.setItem('events', JSON.stringify(events));
                closeModal();
            } else {
                eventTitleInput.classList.add('error');
            }
        }

        function deleteEvent() {
            events = events.filter(e => e.date !== clicked);
            localStorage.setItem('events', JSON.stringify(events));
            closeModal();
        }

        function initButtons() {
            document.getElementById('nextButton').addEventListener('click', () => {
                nav++;
                load();
            });

            document.getElementById('backButton').addEventListener('click', () => {
                nav--;
                load();
            });

            document.getElementById('saveButton').addEventListener('click', saveEvent);
            document.getElementById('cancelButton').addEventListener('click', closeModal);
            document.getElementById('deleteButton').addEventListener('click', deleteEvent);
            document.getElementById('closeButton').addEventListener('click', closeModal);
        }

        initButtons();
        load();
    </script>
</html>
